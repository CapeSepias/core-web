{"version":3,"sources":["view_factory_spec.js"],"names":[],"mappings":"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","file":"angular2/test/render/dom/view/view_factory_spec.es6","sourcesContent":["import {\n  AsyncTestCompleter,\n  beforeEach,\n  ddescribe,\n  xdescribe,\n  describe,\n  el,\n  dispatchEvent,\n  expect,\n  iit,\n  inject,\n  beforeEachBindings,\n  it,\n  xit,\n  SpyObject, proxy\n} from 'angular2/test_lib';\nimport {IMPLEMENTS, isBlank} from 'angular2/src/facade/lang';\nimport {ListWrapper} from 'angular2/src/facade/collection';\nimport {ViewFactory} from 'angular2/src/render/dom/view/view_factory';\nimport {RenderProtoView} from 'angular2/src/render/dom/view/proto_view';\nimport {RenderView} from 'angular2/src/render/dom/view/view';\nimport {ElementBinder} from 'angular2/src/render/dom/view/element_binder';\nimport {ShadowDomStrategy} from 'angular2/src/render/dom/shadow_dom/shadow_dom_strategy';\nimport {LightDom} from 'angular2/src/render/dom/shadow_dom/light_dom'\nimport {EventManager} from 'angular2/src/render/dom/events/event_manager';\n\nexport function main() {\n  describe('RenderViewFactory', () => {\n    var eventManager;\n    var shadowDomStrategy;\n\n    function createViewFactory({capacity}):ViewFactory {\n      return new ViewFactory(capacity, eventManager, shadowDomStrategy);\n    }\n\n    function createProtoView(rootEl=null, binders=null) {\n      if (isBlank(rootEl)) {\n        rootEl = el('<div></div>');\n      }\n      if (isBlank(binders)) {\n        binders = [];\n      }\n      return new RenderProtoView({\n        element: rootEl,\n        elementBinders: binders\n      });\n    }\n\n    function createComponentElBinder(componentId, nestedProtoView = null) {\n      var binder = new ElementBinder({\n        componentId: componentId,\n        textNodeIndices: []\n      });\n      binder.nestedProtoView = nestedProtoView;\n      return binder;\n    }\n\n\n    beforeEach( () => {\n      eventManager = new SpyEventManager();\n      shadowDomStrategy = new SpyShadowDomStrategy();\n    });\n\n    it('should create views without cache', () => {\n      var pv = createProtoView();\n      var vf = createViewFactory({\n        capacity: 0\n      });\n      expect(vf.getView(pv) instanceof RenderView).toBe(true);\n    });\n\n    describe('caching', () => {\n\n      it('should support multiple RenderProtoViews', () => {\n        var pv1 = createProtoView();\n        var pv2 = createProtoView();\n        var vf = createViewFactory({ capacity: 2 });\n        var view1 = vf.getView(pv1);\n        var view2 = vf.getView(pv2);\n        vf.returnView(view1);\n        vf.returnView(view2);\n\n        expect(vf.getView(pv1)).toBe(view1);\n        expect(vf.getView(pv2)).toBe(view2);\n      });\n\n      it('should reuse the newest view that has been returned', () => {\n        var pv = createProtoView();\n        var vf = createViewFactory({ capacity: 2 });\n        var view1 = vf.getView(pv);\n        var view2 = vf.getView(pv);\n        vf.returnView(view1);\n        vf.returnView(view2);\n\n        expect(vf.getView(pv)).toBe(view2);\n      });\n\n      it('should not add views when the capacity has been reached', () => {\n        var pv = createProtoView();\n        var vf = createViewFactory({ capacity: 2 });\n        var view1 = vf.getView(pv);\n        var view2 = vf.getView(pv);\n        var view3 = vf.getView(pv);\n        vf.returnView(view1);\n        vf.returnView(view2);\n        vf.returnView(view3);\n\n        expect(vf.getView(pv)).toBe(view2);\n        expect(vf.getView(pv)).toBe(view1);\n      });\n\n    });\n\n    describe('child components', () => {\n\n      var vf, log;\n\n      beforeEach(() => {\n        vf = createViewFactory({capacity: 1});\n        log = [];\n        shadowDomStrategy.spy('attachTemplate').andCallFake( (el, view) => {\n          ListWrapper.push(log, ['attachTemplate', el, view]);\n        });\n        shadowDomStrategy.spy('constructLightDom').andCallFake( (lightDomView, shadowDomView, el) => {\n          ListWrapper.push(log, ['constructLightDom', lightDomView, shadowDomView, el]);\n          return new SpyLightDom();\n        });\n      });\n\n      it('should create static child component views', () => {\n        var hostPv = createProtoView(el('<div><div class=\"ng-binding\"></div></div>'), [\n          createComponentElBinder(\n            'someComponent',\n            createProtoView()\n          )\n        ]);\n        var hostView = vf.getView(hostPv);\n        var shadowView = hostView.componentChildViews[0];\n        expect(shadowView).toBeTruthy();\n        expect(hostView.lightDoms[0]).toBeTruthy();\n        expect(log[0]).toEqual(['constructLightDom', hostView, shadowView, hostView.boundElements[0]]);\n        expect(log[1]).toEqual(['attachTemplate', hostView.boundElements[0], shadowView]);\n      });\n\n      it('should not create dynamic child component views', () => {\n        var hostPv = createProtoView(el('<div><div class=\"ng-binding\"></div></div>'), [\n          createComponentElBinder(\n            'someComponent',\n            null\n          )\n        ]);\n        var hostView = vf.getView(hostPv);\n        var shadowView = hostView.componentChildViews[0];\n        expect(shadowView).toBeFalsy();\n        expect(hostView.lightDoms[0]).toBeFalsy();\n        expect(log).toEqual([]);\n      });\n\n    });\n\n  });\n}\n\n@proxy\n@IMPLEMENTS(EventManager)\nclass SpyEventManager extends SpyObject {\n  constructor(){super(EventManager);}\n  noSuchMethod(m){return super.noSuchMethod(m)}\n}\n\n@proxy\n@IMPLEMENTS(ShadowDomStrategy)\nclass SpyShadowDomStrategy extends SpyObject {\n  constructor(){super(ShadowDomStrategy);}\n  noSuchMethod(m){return super.noSuchMethod(m)}\n}\n\n@proxy\n@IMPLEMENTS(LightDom)\nclass SpyLightDom extends SpyObject {\n  constructor(){super(LightDom);}\n  noSuchMethod(m){return super.noSuchMethod(m)}\n}\n"]}