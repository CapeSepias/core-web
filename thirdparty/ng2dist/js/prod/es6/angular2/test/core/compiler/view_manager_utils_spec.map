{"version":3,"sources":["view_manager_utils_spec.js"],"names":[],"mappings":"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","file":"angular2/test/core/compiler/view_manager_utils_spec.es6","sourcesContent":["import {\n  AsyncTestCompleter,\n  beforeEach,\n  ddescribe,\n  xdescribe,\n  describe,\n  el,\n  dispatchEvent,\n  expect,\n  iit,\n  inject,\n  beforeEachBindings,\n  it,\n  xit,\n  SpyObject, proxy,\n  Log\n} from 'angular2/test_lib';\n\nimport {Injector, bind} from 'angular2/di';\nimport {IMPLEMENTS, isBlank, isPresent} from 'angular2/src/facade/lang';\nimport {MapWrapper, ListWrapper, StringMapWrapper} from 'angular2/src/facade/collection';\n\nimport {AppProtoView, AppView} from 'angular2/src/core/compiler/view';\nimport {ChangeDetector} from 'angular2/change_detection';\nimport {ElementBinder} from 'angular2/src/core/compiler/element_binder';\nimport {DirectiveBinding, ElementInjector, ElementRef} from 'angular2/src/core/compiler/element_injector';\nimport {DirectiveMetadataReader} from 'angular2/src/core/compiler/directive_metadata_reader';\nimport {Component} from 'angular2/src/core/annotations_impl/annotations';\nimport {AppViewManagerUtils} from 'angular2/src/core/compiler/view_manager_utils';\n\nexport function main() {\n  // TODO(tbosch): add more tests here!\n\n  describe('AppViewManagerUtils', () => {\n\n    var metadataReader;\n    var utils;\n\n    function createInjector() {\n      return new Injector([], null, false);\n    }\n\n    function createDirectiveBinding(type) {\n      var meta = metadataReader.read(type);\n      return DirectiveBinding.createFromType(meta.type, meta.annotation);\n    }\n\n    function createEmptyElBinder() {\n      return new ElementBinder(0, null, 0, null, null);\n    }\n\n    function createComponentElBinder(nestedProtoView = null) {\n      var binding = createDirectiveBinding(SomeComponent);\n      var binder = new ElementBinder(0, null, 0, null, binding);\n      binder.nestedProtoView = nestedProtoView;\n      return binder;\n    }\n\n    function createProtoView(binders = null) {\n      if (isBlank(binders)) {\n        binders = [];\n      }\n      var res = new AppProtoView(null, null, null, null, null);\n      res.elementBinders = binders;\n      return res;\n    }\n\n    function createElementInjector() {\n      return SpyObject.stub(new SpyElementInjector(), {\n        'isExportingComponent' : false,\n        'isExportingElement' : false,\n        'getEventEmitterAccessors' : [],\n        'getComponent' : null,\n        'getDynamicallyLoadedComponent': null\n      }, {});\n    }\n\n    function createView(pv=null) {\n      if (isBlank(pv)) {\n        pv = createProtoView();\n      }\n      var view = new AppView(null, pv, MapWrapper.create());\n      var elementInjectors = ListWrapper.createFixedSize(pv.elementBinders.length);\n      for (var i=0; i<pv.elementBinders.length; i++) {\n        elementInjectors[i] = createElementInjector();\n      }\n      view.init(new SpyChangeDetector(),\n        elementInjectors,\n        [],\n        ListWrapper.createFixedSize(pv.elementBinders.length),\n        ListWrapper.createFixedSize(pv.elementBinders.length)\n      );\n      return view;\n    }\n\n    beforeEach( () => {\n      metadataReader = new DirectiveMetadataReader();\n      utils = new AppViewManagerUtils(metadataReader);\n    });\n\n    describe('hydrateDynamicComponentInElementInjector', () => {\n\n      it('should not allow to overwrite an existing component', () => {\n        var hostView = createView(createProtoView(\n          [createComponentElBinder(createProtoView())]\n        ));\n        var componentBinding = bind(SomeComponent).toClass(SomeComponent);\n        SpyObject.stub(hostView.elementInjectors[0], {\n          'getDynamicallyLoadedComponent': new SomeComponent()\n        });\n        expect(\n          () => utils.hydrateDynamicComponentInElementInjector(hostView, 0, componentBinding, null)\n        ).toThrowError('There already is a dynamic component loaded at element 0');\n      });\n\n    });\n\n    describe(\"hydrateComponentView\", () => {\n\n      it(\"should hydrate the change detector after hydrating element injectors\", () => {\n        var log = new Log();\n\n        var componentView = createView(createProtoView([createEmptyElBinder()]));\n        var hostView = createView(createProtoView([createComponentElBinder(createProtoView())]));\n        hostView.componentChildViews = [componentView];\n\n        // (() => () nonsense is required until our transpiler supports type casting\n        var spyEi = (() => componentView.elementInjectors[0])();\n        spyEi.spy('instantiateDirectives').andCallFake(log.fn('instantiateDirectives'));\n\n        var spyCd = (() => componentView.changeDetector)();\n        spyCd.spy('hydrate').andCallFake(log.fn('hydrateCD'));\n\n        utils.hydrateComponentView(hostView, 0)\n\n        expect(log.result()).toEqual('instantiateDirectives; hydrateCD');\n      });\n\n    });\n\n    describe('shared hydrate functionality', () => {\n\n      it(\"should set up event listeners\", () => {\n        var dir = new Object();\n\n        var hostPv = createProtoView([\n          createComponentElBinder(null),\n          createEmptyElBinder()\n        ]);\n        var hostView = createView(hostPv);\n        var spyEventAccessor1 = SpyObject.stub({\"subscribe\" : null});\n        SpyObject.stub(hostView.elementInjectors[0], {\n          'getEventEmitterAccessors': [[spyEventAccessor1]],\n          'getDirectiveAtIndex': dir\n        });\n        var spyEventAccessor2 = SpyObject.stub({\"subscribe\" : null});\n        SpyObject.stub(hostView.elementInjectors[1], {\n          'getEventEmitterAccessors': [[spyEventAccessor2]],\n          'getDirectiveAtIndex': dir\n        });\n\n        var shadowView = createView();\n        utils.attachComponentView(hostView, 0, shadowView);\n\n        utils.attachAndHydrateInPlaceHostView(null, null, hostView, createInjector());\n\n        expect(spyEventAccessor1.spy('subscribe')).toHaveBeenCalledWith(hostView, 0, dir);\n        expect(spyEventAccessor2.spy('subscribe')).toHaveBeenCalledWith(hostView, 1, dir);\n      });\n\n    });\n\n  });\n\n}\n\n@Component({ selector: 'someComponent' })\nclass SomeComponent {}\n\n@proxy\n@IMPLEMENTS(ElementInjector)\nclass SpyElementInjector extends SpyObject {\n  constructor(){super(ElementInjector);}\n  noSuchMethod(m){return super.noSuchMethod(m)}\n}\n\n@proxy\n@IMPLEMENTS(ChangeDetector)\nclass SpyChangeDetector extends SpyObject {\n  constructor(){super(ChangeDetector);}\n  noSuchMethod(m){return super.noSuchMethod(m)}\n}\n"]}